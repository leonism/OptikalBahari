---
---
document.addEventListener('DOMContentLoaded', function() {
  const searchContainer = document.getElementById('algolia-search-container');
  if (!searchContainer) return;

  // Configuration from Jekyll Site Data (injected from ENV)
    const algoliaConfig = {
      appId: '{{ site.data.algolia_credentials.application_id }}',
      apiKey: '{{ site.data.algolia_credentials.search_only_api_key }}',
      indexName: '{{ site.data.algolia_credentials.index_name }}'
    };

    // Check if credentials are placeholders or missing
    if (!algoliaConfig.appId || algoliaConfig.appId === 'YOUR_ALGOLIA_APP_ID') {
      console.warn('Algolia Search: Please configure your App ID and API Key in .env file');
      return;
    }

    const search = instantsearch({
      indexName: algoliaConfig.indexName,
      searchClient: algoliasearch(algoliaConfig.appId, algoliaConfig.apiKey),
      searchFunction(helper) {
        const container = document.querySelector('#hits');
        if (helper.state.query) {
          container.classList.add('has-results');
          helper.search();
        } else {
          container.classList.remove('has-results');
          container.innerHTML = '';
        }
      }
    });

    search.addWidgets([
      instantsearch.widgets.searchBox({
      container: '#searchbox',
      placeholder: 'Cari Optikal Bahari...',
      showReset: true,
      showSubmit: true,
      showLoadingIndicator: true,
      cssClasses: {
        root: 'custom-search-box',
        form: 'form-inline',
        input: 'form-control form-control-sm rounded-pill border custom-search',
        submit: 'btn btn-link search-btn',
        reset: 'btn btn-link reset-btn'
      }
    })
  ]);

  // Hits Widget
  search.addWidgets([
    instantsearch.widgets.hits({
      container: '#hits',
      templates: {
        empty: '{% raw %}<div class="p-3 text-center text-muted">No results found for "<strong>{{query}}</strong>"</div>{% endraw %}',
        item: `{% raw %}
          <a href="{{url}}" class="result-item">
            <h4>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</h4>
            <p>{{#helpers.snippet}}{ "attribute": "content" }{{/helpers.snippet}}</p>
          </a>
        {% endraw %}`
      },
      cssClasses: {
        list: 'list-unstyled m-0',
        item: 'border-bottom'
      }
    })
  ]);

  // Configure Hits to be hidden initially and handling styling
  search.on('render', function() {
    const hitsContainer = document.querySelector('#hits');
    const searchInput = document.querySelector('.ais-SearchBox-input');

    // Hide hits if input is empty (handled by searchFunction, but double check)
    if (searchInput && searchInput.value.trim() === '') {
      hitsContainer.classList.remove('has-results');
    }
  });

  search.start();
});
